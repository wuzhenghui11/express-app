<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title> Slider </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
body, td, ul, li { margin:0; padding:0 }
table { border-collapse: collapse; border-spacing:0 }
#container { width:610px; height:205px; position:relative; overflow: hidden; margin:0 auto; }
#scroller { position:absolute; }
#page { position: absolute; float:right; left:520px; top:180px;}
#page li { float:left; cursor:pointer; list-style:none; width:15px; height:15px; line-height:15px; font-family:Arial; font-size:12px; margin:1px; text-align:center;background:url("flashbutton.gif") no-repeat scroll -15px 0 transparent;}
#page li.on {background:url("flashbutton.gif") no-repeat scroll 0 0 transparent;color:#FFFFFF;}
</style>
</head>
<body>
<div id="container">
	<table id="scroller" >
		<tr>
			<td><img src="images/1.jpg" /></td>
			<td><img src="images/2.jpg" /></td>
			<td><img src="images/3.jpg" /></td>
			<td><img src="images/4.jpg" /></td>
			<td><img src="images/5.jpg" /></td>
		</tr>
	</table>
	<ul id="page"></ul>
</div>
<script>
var QQ = function() {
	// 公用函数
	function T$(id){
		return document.getElementById(id);//获得ID
	}
	function T$$(root, tag){
		return (root || document).getElementsByTagName(tag);//获得标签
	}
	function $extend(des, src){
		for(var p in src){
			des[p] = src[p];//合并数组
		}
		return des;
	}
	function $each(arr, callback){
		for(var i=0;i<arr.length;i++){
			callback(arr[i], i);
		}
	}
	function currentStyle(elem, style){
		return elem.currentStyle || document.defaultView.getComputedStyle(elem, null);
	}
	
	// 缓动类
	var Tween = {
		Quart: {//t为时间，b为元素距离左侧的起实位置，c为元素改变的距离  d为切换时间
			//self.moveTo(Math.round(self.config.tween(self.time++, self.begin, self.change, self.duration)));
			easeOut: function(t,b,c,d){
				return -c * ((t=t/d-1)*t*t*t - 1) + b;
			}
		},
		Back: {
			easeOut: function(t,b,c,d,s){
				if (s == undefined) s = 1.70158;
				return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
			}
		},
		Bounce: {
			easeOut: function(t,b,c,d){
				if ((t/=d) < (1/2.75)) {
					return c*(7.5625*t*t) + b;
				} else if (t < (2/2.75)) {
					return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
				} else if (t < (2.5/2.75)) {
					return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
				} else {
					return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
				}
			}
		}
	}
	// 默认配置
	var defaultConfig = {
		trigger: 1, // 触发方式1:click other: mouseover
		auto: true, // 是否自动切换
		tween: Tween.Quart.easeOut, // 默认缓动类
		Time: 10, // 滑动延时
		duration: 50,	// 切换时间
		pause: 3000, // 停顿时间
		start: function() {}, // 切换开始执行函数
		end: function() {} // 切换结束执行函数
	};

	// 主类构造函数
	var scrollTrans = function(cid, sid, count, config) {
		var self = this;
		if (!(self instanceof scrollTrans)) {
			return new scrollTrans(cid, sid, count, config);
		} 
		self.container = T$(cid);
		self.scroller = T$(sid);
		if (!(self.container || self.scroller)) { 
			return;
		} 
		self.config = $extend(defaultConfig, config || {});
		self.index = 0;
		self.timer = null;
		self.count = count;
		self.step = self.scroller.offsetWidth / count;
		
	};

	scrollTrans.prototype = {
		//constructor: scrollTrans,可以去掉
		transform: function(index) {
			var self = this;
			index == undefined && (index = self.index);
			index < 0 && (index = self.count - 1) || index >= self.count && (index = 0);
			self.time = 0;
			self.target = -Math.abs(self.step) * (self.index = index);//需要滑动的距离
			self.begin = parseInt(currentStyle(self.scroller)['left']);//获得元素的起实位置
			self.change = self.target - self.begin;//元素改变的距离
			self.duration = self.config.duration;
			self.start();
			self.run();
		},

		run: function() {
			var self = this;
			clearTimeout(self.timer);
			if (self.change && self.time < self.duration) {
				self.moveTo(Math.round(self.config.tween(self.time++, self.begin, self.change, self.duration)));
				self.timer = setTimeout(function() {self.run()}, self.config.Time);
			} else {
				self.moveTo(self.target);
				self.config.auto && (self.timer = setTimeout(function() {self.next()}, self.config.pause));
			}
			console.log(self.time);
		},

		moveTo: function(i) {
			this.scroller.style.left = i + 'px';
		},

		next: function() {
			this.transform(++this.index);
		}
	};

	return {
		scroll: function(cid, sid, count, config) {
			window.onload = function() {
				//循环图片数目插入li
				var frag = document.createDocumentFragment(),
					nums = [];
				for (var i = 0; i < count; i++) {
					var li = document.createElement('li');
					(nums[i] = frag.appendChild(document.createElement('li'))).innerHTML = i + 1;
				}
				T$('page').appendChild(frag);//插入li

				// 调用主类
				var st = scrollTrans(cid, sid, count, config);
				$each(nums, function(o, i){
					o[st.config.trigger == 1 ? 'onclick' : 'onmouseover'] = function() { o.className = 'on'; st.transform(i); }
					o.onmouseout = function() { o.className = ''; st.transform();}
				});
				/*function $each(arr, callback, thisp){
					for(var i=0;i<arr.length;i++){
						callback.call(thisp, arr[i],i//这个无用,arr);
					}
				}*/
				st.start = function() {
					$each(nums, function(o, i) {
						o.className = st.index == i ? 'on' : '';
					});	
				};
				st.transform();
			}
		}
	}
}();
	
QQ.scroll('container' /*外部容器ID*/, 'scroller'/*滑动容器ID*/, 5/*切换图片数目*/, {trigger: 0} /*默认配置*/);
</script>
</body>
</html>
